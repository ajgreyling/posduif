# Flutter Web App Rules

## Language & Version
- Use Flutter 3.13 or later
- Use Dart 3.0 or later
- Follow Flutter/Dart best practices and conventions
- Use `dart format` for code formatting
- Optimize for web performance

## Dependencies - FOSS ONLY

### Allowed Packages (Examples of FOSS Flutter packages):
- **State Management**: `flutter_riverpod` (MIT), `provider` (MIT)
- **HTTP Client**: `dio` (MIT), `http` (BSD 3-Clause)
- **SSE**: `sse` (MIT), `eventsource` (MIT) - for Server-Sent Events
- **QR Code**: `qr_flutter` (MIT) - for QR code generation
- **JSON**: `json_serializable` (BSD 3-Clause)
- **Logging**: `logger` (MIT)
- **Routing**: `go_router` (BSD 3-Clause), `auto_route` (MIT)

### Forbidden:
- Any package requiring a license key or subscription
- Proprietary or commercial-only packages
- Packages with restrictive licenses (GPL, AGPL, etc.)
- Packages that depend on third-party SaaS services
- Firebase packages (use self-hosted alternatives)

## Project Structure

```
lib/
  core/              # Core functionality
    api/            # API client
    auth/           # Authentication service
  features/          # Feature modules
    auth/          # Authentication UI
    enrollment/    # Mobile user enrollment
    messaging/     # Messaging UI
  shared/            # Shared utilities
    widgets/       # Reusable widgets
    utils/         # Utility functions
test/               # Tests
web/                # Web-specific assets and config
```

## Code Guidelines

- Use Riverpod for state management
- Implement responsive design
- Use SSE for real-time updates
- Implement polling fallback for SSE
- Handle authentication state
- Use proper error handling
- Write unit and widget tests
- Optimize for web performance

## Real-Time Updates

- Use Server-Sent Events (SSE) for real-time notifications
- Implement polling fallback when SSE unavailable
- Handle connection errors gracefully
- Reconnect automatically on disconnect
- Show connection status to users

## Web-Specific Considerations

- Optimize bundle size
- Implement code splitting if needed
- Use web-optimized widgets
- Handle browser compatibility
- Implement proper CORS handling
- Support keyboard navigation
- Ensure accessibility

## Performance

- Minimize initial load time
- Use lazy loading for routes
- Optimize images and assets
- Implement proper caching
- Use compression for API responses
- Monitor performance metrics

## Security

- Store tokens securely (use secure storage or httpOnly cookies)
- Validate all inputs
- Use HTTPS for all API calls
- Implement CSRF protection
- Sanitize user inputs
- Never log sensitive data

## Testing

- Write unit tests for business logic
- Write widget tests for UI components
- Test authentication flow
- Test enrollment flow
- Test messaging functionality
- Test SSE connection handling

## UI/UX

- Implement responsive design
- Support keyboard shortcuts
- Ensure accessibility (WCAG compliance)
- Provide clear error messages
- Show loading states
- Implement proper navigation

